     1                                  bits 32
     2                                  global start 
     3                                  import fclose msvcrt.dll
     4                                  import fscanf msvcrt.dll
     5                                  import fopen msvcrt.dll
     6                                  import scanf msvcrt.dll
     7                                  import printf msvcrt.dll
     8                                  import fprintf msvcrt.dll
     9                                  import gets msvcrt.dll
    10                                  import exit msvcrt.dll
    11                                  import fread msvcrt.dll
    12                                  import getchar msvcrt.dll
    13                                  extern printf, exit, scanf, fopen, fscanf, fclose, fprintf, gets,fread,getchar
    14                                  
    15                                  
    16                                  
    17                                  
    18                                  segment data use32 class=data
    19                                  
    20 00000000 00000000                caracter dd 0
    21 00000004 <res 00000064>          sir resb 100
    22 00000068 256300                  format_ch db '%c',0
    23 0000006B 6F75747075742E7478-     file db 'output.txt',0
    23 00000074 7400               
    24 00000076 6100                    mod_acces db 'a',0
    25 00000078 FFFFFFFF                descriptor dd -1
    26 0000007C 257300                  format_afis db '%s',0
    27                                  
    28 0000007F 00000000                len dd 0
    29                                  segment code use32 class=code
    30                                  start:
    31 00000000 68[04000000]                push sir
    32 00000005 E89A000000                  call read
    33                                      
    34 0000000A 891D[7F000000]              mov [len],ebx
    35 00000010 68[04000000]                push sir 
    36 00000015 FF35[7F000000]              push dword [len]
    37 0000001B E85B000000                  call sortare
    38                                      
    39 00000020 68[04000000]                push sir
    40 00000025 68[7C000000]                push format_afis
    41 0000002A FF15[00000000]              call [printf]
    42 00000030 83C408                          add esp,4*2
    43                                      
    44 00000033 68[76000000]                push mod_acces
    45 00000038 68[6B000000]                push file
    46 0000003D FF15[00000000]              call [fopen]
    47 00000043 83C408                      add esp,4*2
    48                                      
    49 00000046 A3[78000000]                mov [descriptor],eax
    50                                      
    51 0000004B 68[04000000]                push sir 
    52 00000050 68[7C000000]                push format_afis
    53 00000055 FF35[78000000]              push dword[descriptor]
    54 0000005B FF15[00000000]              call [fprintf]
    55 00000061 83C40C                      add esp,4*3
    56                                      
    57 00000064 FF35[78000000]              push dword[descriptor]
    58 0000006A FF15[00000000]              call [fclose]
    59 00000070 83C404                      add esp,4
    60 00000073 6A00                        push dword 0
    61 00000075 FF15[00000000]              call [exit]
    62                                  
    63                                      
    64                                      sortare:
    65 0000007B 8B4C2404                        mov ecx,[esp+4]
    66 0000007F 49                              dec ecx
    67 00000080 8B742408                        mov esi,[esp+8]
    68 00000084 BB01000000                      MOV EBX,1
    69                                          parcurgere:
    70 00000089 AC                                  lodsb
    71 0000008A 3A06                                cmp al,byte[esi]
    72 0000008C 760C                                JBE jos
    73 0000008E 8A16                                mov dl,byte[esi]
    74 00000090 8856FF                              mov [esi-1],dl
    75 00000093 8806                                mov [esi],al
    76 00000095 BB00000000                          mov ebx,0
    77                                              jos:
    78 0000009A E2ED                                loop parcurgere
    79 0000009C 83FB01                              CMP EBX,1
    80 0000009F 75DA                                JNE sortare
    81 000000A1 C20800                          ret 4*2
    82                                      
    83                                      read:
    84 000000A4 8B7C2404                    mov edi,[esp+4]
    85 000000A8 BB00000000                  mov ebx,0
    86 000000AD FC                          cld
    87                                      citire:
    88                                          ;scanf(%c,caracter)
    89 000000AE 68[00000000]                    push caracter
    90 000000B3 68[68000000]                    push format_ch
    91 000000B8 FF15[00000000]                  call [scanf]
    92 000000BE 83C408                          add esp,4*2
    93                                          
    94                                          ;call [getchar]
    95 000000C1 803D[00000000]21                cmp byte[caracter],'!'
    96 000000C8 7419                            JE iesire_bucla
    97                                          
    98 000000CA A0[00000000]                    mov al,byte[caracter]
    99 000000CF 802D[00000000]30                sub byte[caracter],'0'
   100 000000D6 F605[00000000]01                test byte[caracter],1
   101 000000DD 75CF                            JNZ citire
   102 000000DF 43                              inc ebx
   103 000000E0 AA                              stosb
   104 000000E1 EBCB                            JMP citire
   105                                    
   106                                      iesire_bucla:
   107 000000E3 C20400                      ret 4
